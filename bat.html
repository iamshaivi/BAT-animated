<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pixel Bat — FIXED</title>
<style>
  html,body {
    height:100%;
    margin:0;
    background:#ffffff;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .bat {
    width: 32px;
    height: 32px;
    background-repeat: no-repeat;
    background-position: 0 0;
    transform-origin: center;
    image-rendering: pixelated;
    transform: scale(6);
    animation: flap 0.45s steps(6) infinite,
               bob 0.9s ease-in-out infinite alternate;
    user-select:none;
    -webkit-user-select: none;
  }

  @keyframes flap { to { background-position: -256px 0; } }

  @keyframes bob {
    0%   { transform: scale(6) translateY(0) rotate(-3deg); }
    50%  { transform: scale(6) translateY(-5px) rotate(3deg); }
    100% { transform: scale(6) translateY(0) rotate(-3deg); }
  }

  .controls {
    position:fixed;
    right:12px;
    top:12px;
    font-family:Arial,Helvetica,sans-serif;
    font-size:13px;
    color:#333;
    background:rgba(255,255,255,0.9);
    padding:8px 10px;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,0.07);
    display:flex;
    gap:10px;
    align-items:center;
  }
  label{display:flex;gap:6px;align-items:center;}
</style>
</head>
<body>

<div class="bat" id="bat">
  <label><input type = "checkbox" id = "fast">FAST</label>
  <label>Scale<input <input id="scale" type="range" min="2" max="10" step="0.5" value="6"></label>
 </div> 

<script>
function generateBatSprite(color = '#000000') {
  const fw = 32, fh = 32;
  const block = 3; 
  const framesData = [
    // frame 0 — wings down
    [
      [15,10],[16,10],[14,11],[15,11],[16,11],[17,11],[14,12],[15,12],[16,12],[17,12],[15,13],[16,13],
      [10,12],[9,13],[8,14],[7,15],[11,11],[12,12],
      [21,12],[22,13],[23,14],[24,15],[20,11],[19,12]
    ],
    // frame 1 — mid-up
    [
      [15,10],[16,10],[14,11],[15,11],[16,11],[17,11],[15,12],[16,12],
      [11,9],[10,10],[9,11],[8,12],[12,10],
      [20,9],[21,10],[22,11],[23,12],[19,10]
    ],
    // frame 2 — up
    [
      [15,10],[16,10],[14,11],[15,11],[16,11],
      [12,7],[11,8],[10,9],[9,10],
      [19,7],[20,8],[21,9],[22,10],
      [13,9],[18,9]
    ],
    // frame 3 — mid (repeat-ish)
    [
      [15,10],[16,10],[14,11],[15,11],[16,11],[17,11],[15,12],[16,12],
      [11,9],[10,10],[9,11],[8,12],[12,10],
      [20,9],[21,10],[22,11],[23,12],[19,10]
    ],
    // frame 4 — down slight variant
    [
      [15,10],[16,10],[14,11],[15,11],[16,11],[17,11],[14,12],[15,12],[16,12],[17,12],
      [10,12],[9,13],[8,14],[7,15],[11,11],[12,12],
      [21,12],[22,13],[23,14],[24,15],[20,11],[19,12]
    ],
    // frame 5 — relaxed
    [
      [15,11],[16,11],[14,12],[15,12],[16,12],
      [12,10],[11,11],[10,12],
      [20,10],[21,11],[22,12]
    ],
  ];

  const frames = framesData.length;
  const canvas = document.createElement('canvas');
  canvas.width = frames * fw;
  canvas.height = fh;
  const ctx = canvas.getContext('2d');

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = color;

  const drawBlock = (frameIndex, x, y) => {
    const px = frameIndex * fw + Math.round(x * (block / 1));
    const py = Math.round(y * (block / 1));
    ctx.fillRect(px, py, block, block);
  };

  framesData.forEach((dots, frameIndex) => {
    dots.forEach(([x,y]) => drawBlock(frameIndex, x, y));
  });

  return {
    dataUrl: canvas.toDataURL(),
    frames,
    fw,
    fh
  };
}

const el = document.getElementById('bat');
const sprite = generateBatSprite('#000000');
el.style.backgroundImage = `url(${sprite.dataUrl})`;
el.style.backgroundSize = `${sprite.frames * sprite.fw}px ${sprite.fh}px`;
el.style.animation = `flap 0.45s steps(${sprite.frames}) infinite, bob 0.9s ease-in-out infinite alternate`;

const chk = document.getElementById('fast');
const range = document.getElementById('scale');

if (chk) {
  chk.addEventListener('change', () => {
    if (chk.checked) {
      el.style.animationDuration = '0.28s, 0.7s';
    } else {
      el.style.animationDuration = '';
    }
  });
}

if (range) {
  range.addEventListener('input', () => {
    const s = range.value;
    el.style.transform = `scale(${s})`;

    let bobStyle = document.getElementById('bob-dynamic');
    if (!bobStyle) {
      bobStyle = document.createElement('style');
      bobStyle.id = 'bob-dynamic';
      document.head.appendChild(bobStyle);
    }
    bobStyle.innerHTML = `
      @keyframes bob {
        0%   { transform: scale(${s}) translateY(0) rotate(-3deg); }
        50%  { transform: scale(${s}) translateY(-5px) rotate(3deg); }
        100% { transform: scale(${s}) translateY(0) rotate(-3deg); }
      }`;
  });

  range.dispatchEvent(new Event('input'));
}
</script>
</body>
</html>
